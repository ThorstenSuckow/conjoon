Ext.namespace("Ext.ux.util");Ext.ux.util.FlashControl=function(B){B=B||{};var C=B.flashComponent;var A=B.container;var D=null;if(this.getListenerConfig==Ext.emptyFn){D=B.getListenerConfig}delete B.flashComponent;delete B.container;delete B.getListenerConfig;Ext.apply(this,B);this.registerComponents(C,A,D)};Ext.ux.util.FlashControl.prototype={flashComponent:null,container:null,autoDestroy:false,autoDragTracker:false,autoAddListeners:false,quirksFF:false,quirksIE:false,dragTrackers:null,listeners:null,appliedListeners:null,windowParent:null,autoEvents:["expand","beforeexpand","collapse","beforecollapse","activate","deactivate","maximize"],lastWindow:null,getListenerConfig:Ext.emptyFn,registerComponents:function(C,B,A){if(A){this.getListenerConfig=A}this.initData(C,B)},initData:function(B,A){if(this.flashComponent&&this.flashComponent!=B){this.flashComponent.un("destroy",this.onDestroy,this);this.removeListeners();if(!B){this.flashComponent.destroy()}}if(B&&B!=this.flashComponent){B.on("destroy",this.onDestroy,this)}if(this.container&&this.container!=A){this.container.un("afterrender",this.refreshListeners,this);this.container.un("destroy",this.onDestroy,this);this.container.un("afterlayout",this.afterContainerLayout,this);this.removeListeners()}if(A&&A!=this.container){A.on("afterrender",this.refreshListeners,this);A.on("destroy",this.onDestroy,this);A.on("afterlayout",this.afterContainerLayout,this)}if(!B||!A){this.removeListeners()}this.flashComponent=B;this.container=A;if(this.container&&this.container.rendered){this.refreshListeners();this.afterContainerLayout()}},onDestroy:function(A){if(A==this.container){if(this.autoDestroy){this.initData(null,null)}else{this.initData(null,this.flashComponent)}}else{if(this.component==this.flashComponent){this.initData(this.container,null)}else{this.initData(null,null)}}this.getListenerConfig=Ext.emptyFn},afterContainerLayout:function(){var A=this.container.body.getHeight();var B=this.container.body.getWidth();if(Ext.isIE&&this.quirksIE){this.flashComponent.setSize({height:0,width:0});(function(){this.flashComponent.setSize({height:A,width:B})}).defer(100,this)}else{this.flashComponent.setSize({height:A,width:B})}this.flashComponent.setPosition(this.container.body.getX(),this.container.body.getY());if(!this.flashComponent.rendered){this.flashComponent.render(document.body);this.flashComponent.addClass("ext-ux-flashcontrol");this.flashComponent.el.setStyle("position","absolute")}if(this.windowParent){var C=parseInt(this.windowParent.el.getStyle("zIndex"));if(C>=0){this.flashComponent.el.setStyle("zIndex",C+1)}}},refreshListeners:function(){this.removeListeners();this.applyListenerConfig();this.addListeners()},applyListenerConfig:function(){this.listeners=this.getListenerConfig.call(this)},detectWindows:function(){var A=this.container;while(A){if(A instanceof Ext.Window){if(!this.windowParent){this.windowParent=A}this.lastWindow=A}A=A.ownerCt}if(Ext.isGecko&&this.quirksFF&&(this.lastWindow.maximizable)&&this.lastWindow.container.dom==document.body){var C=this.lastWindow.container.getStyle("overflow");var B=Ext.util.CSS.getRule(".ext-ux-flashcontrol-container.x-window-maximized-ct");Ext.util.CSS.updateRule(".ext-ux-flashcontrol-container.x-window-maximized-ct","overflow",C);this.lastWindow.container.addClass("ext-ux-flashcontrol-container")}},autoInstallListeners:function(){if(!this.autoAddListeners){return }var C=this.container;var F=[];var G={};if(this.autoAddListeners===true){F=this.autoEvents}else{if(Ext.isArray(this.autoAddListeners)){F=this.autoAddListeners}}for(var E=0,A=F.length;E<A;E++){if(this.autoEvents.indexOf(F[E])!=-1){G[this.autoAddListeners[E]]=true}}var B=this.showFlashComponent,D=this.hideFlashComponent;while(C){if(this.autoAddListeners){switch(true){case (C.events.activate||C.events.deactivate):if(G.activate){C.on("activate",B,this);this.appliedListeners.push([C,"activate",B,this])}if(G.deactivate){C.on("deactivate",D,this);this.appliedListeners.push([C,"deactivate",D,this])}case (C.maximize||C.maximizable):if(G.maximize){C.on("maximize",B,this);this.appliedListeners.push([C,"maximize",B,this])}case (C.collapsible):switch(true){case (G.expand):C.on("expand",B,this);this.appliedListeners.push([C,"expand",B,this]);case (G.beforeexpand):C.on("beforeexpand",D,this);this.appliedListeners.push([C,"beforeexpand",D,this]);case (G.collapse):C.on("collapse",D,this);this.appliedListeners.push([C,"collapse",D,this]);case (G.beforecollapse):C.on("beforecollapse",D,this);this.appliedListeners.push([C,"beforecollapse",D,this]);break}break}}C=C.ownerCt}},installDragTrackers:function(){if(!this.autoDragTracker){return }var B=this.container,C=null,A=null;if(!this.dragTrackers){this.dragTrackers=[]}while(B){if(B.dd){A=B.dd.getDragEl();C=new Ext.dd.DragTracker({el:new Ext.Element(A),active:true,autoStart:100});C.on("dragstart",this.dragstart,this);C.on("dragend",this.dragend,this,(Ext.isIE?{delay:100}:{}));this.appliedListeners.push([C,"dragstart",this.dragstart,this]);this.appliedListeners.push([C,"dragend",this.dragend,this]);this.dragTrackers.push(C)}B=B.ownerCt}},addListeners:function(){if(!this.appliedListeners){this.appliedListeners=[]}this.installDragTrackers();this.detectWindows();this.autoInstallListeners();var H=null,D=null,Q=null,L=null,O=null,B=null,J=false,P=null,G=false,A=null,I=false,K=false;for(var F in this.listeners){B=this.listeners[F];J=Ext.isString(B.fn);G=(Ext.isArray(B.strict)||(Ext.isObject(B.strict)&&B.strict.getId()))?true:false;H=F;Q=B.scope&&!J?B.scope:this;O=B.strict!==false&&!G?true:(G?B.strict:false);L=B.items;D=J?this[B.fn]:B.fn;for(var N=0,E=L.length;N<E;N++){P=L[N];if(O===false){P.on(H,D,Q);this.appliedListeners.push([P,H,D,Q])}else{if(O===true){A=this.container;while(A){if(A==P){P.on(H,D,Q);this.appliedListeners.push([P,H,D,Q]);break}A=A.ownerCt}}else{if(G){O=[].concat(O);for(var M=0,C=O.length;M<C;M++){if(O[M].findById(this.container.getId())&&O[M].findById(P.getId())){P.on(H,D,Q);this.appliedListeners.push([P,H,D,Q])}}}}}}}},removeListeners:function(){if(this.dragTrackers){for(var B=0,A=this.dragTrackers.length;B<A;B++){this.dragTrackers[B].destroy()}this.dragTrackers=null}if(this.quirksFF&&this.lastWindow&&this.lastWindow.container.dom==document.body){this.lastWindow.container.removeClass("ext-ux-flashcontrol-container")}this.lastWindow=null;this.windowParent=null;if(!this.appliedListeners){return }var C=null;for(var B=0,A=this.appliedListeners.length;B<A;B++){C=this.appliedListeners[B];C[0].un(C[1],C[2],C[3])}this.appliedListeners=[]},hideFlashComponent:function(){this.flashComponent.hide()},showFlashComponent:function(){this.afterContainerLayout();this.flashComponent.show()},dragstart:function(){this.flashComponent.hide()},dragend:function(){this.afterContainerLayout();this.flashComponent.show()}};